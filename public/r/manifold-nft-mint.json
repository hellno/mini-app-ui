{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "manifold-nft-mint",
  "type": "registry:block",
  "description": "A complete Manifold NFT minting flow component with wallet connection, transaction handling, and 5-step user experience",
  "dependencies": [
    "lucide-react",
    "wagmi",
    "viem",
    "@farcaster/frame-wagmi-connector",
    "@radix-ui/react-slot",
    "class-variance-authority",
    "clsx",
    "tailwind-merge",
    "lucide-react",
    "@farcaster/frame-sdk",
    "@farcaster/frame-core",
    "wagmi",
    "viem",
    "@farcaster/frame-wagmi-connector",
    "."
  ],
  "devDependencies": [],
  "registryDependencies": [
    "button",
    "sheet"
  ],
  "files": [
    {
      "path": "registry/mini-app/blocks/manifold-nft-mint/manifold-nft-mint.tsx",
      "content": "\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { Button } from \"@/registry/mini-app/ui/button\";\r\nimport { Sheet, SheetContent, SheetHeader, SheetTitle } from \"@/registry/mini-app/ui/sheet\";\r\nimport { useMiniAppSdk } from \"@/registry/mini-app/hooks/use-miniapp-sdk\";\r\nimport { useAccount, useConnect, useWriteContract} from \"wagmi\";\r\nimport { formatEther, type Address } from \"viem\";\r\nimport { farcasterFrame } from \"@farcaster/frame-wagmi-connector\";\r\nimport { Coins, CheckCircle, AlertCircle, Loader2 } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Claim, ERC20Abi, getClientForChain, getNftDetails, manifoldERC1155ExtensionAbi } from \"./config\";\r\n\r\ntype ManifoldNFTMintFlowProps = {\r\n  chainId: number;\r\n  contractAddress: Address;\r\n  instanceId?: string;\r\n  tokenId?: string;\r\n  className?: string;\r\n  variant?: \"default\" | \"destructive\" | \"secondary\" | \"ghost\" | \"outline\";\r\n  size?: \"default\" | \"sm\" | \"lg\" | \"icon\";\r\n  buttonText?: string;\r\n  disabled?: boolean;\r\n  onMintSuccess?: (txHash: string) => void;\r\n  onMintError?: (error: string) => void;\r\n};\r\n\r\ntype MintStep = \"initial\" | \"approve\" | \"sheet\" | \"connecting\" | \"minting\" | \"waiting\" | \"success\" | \"error\" | \"warning\";\r\n\r\nexport type Config = {\r\n  contractAddress: Address;\r\n  instanceId: string;\r\n  chainId: number;\r\n  tokenId: bigint;\r\n  claim: Claim;\r\n  extenstionContractAddress: Address;\r\n  erc20ContractAddress?: Address;\r\n  erc20Decimals?: number;\r\n  erc20Symbol?: string;\r\n  mintFee?: string;\r\n}\r\n\r\nexport function ManifoldNFTMint({\r\n  chainId,\r\n  contractAddress,\r\n  instanceId,\r\n  tokenId,\r\n  className,\r\n  variant = \"default\",\r\n  size = \"default\",\r\n  buttonText = \"Mint NFT\",\r\n  disabled = false,\r\n  onMintSuccess,\r\n  onMintError,\r\n}: ManifoldNFTMintFlowProps) {\r\n  const [step, setStep] = React.useState<MintStep>(\"initial\");\r\n  const [error, setError] = React.useState<string>(\"\");\r\n  const [txHash, setTxHash] = React.useState<string>(\"\");\r\n  const [isLoading, setIsLoading] = React.useState(false);\r\n  const [isSheetOpen, setIsSheetOpen] = React.useState(false);\r\n  const { isSDKLoaded } = useMiniAppSdk();\r\n  const { isConnected, address } = useAccount();\r\n  const { connect } = useConnect();\r\n  const { writeContractAsync , isError, error: writeContractError} = useWriteContract();\r\n\r\n  const [config, setConfig] = React.useState<Config | undefined>(undefined);\r\n  const [mintfee, setMintFee] = React.useState<string>(\"\");\r\n \r\n\r\n  // Reset error when step changes\r\n  React.useEffect(() => {\r\n    if (step !== \"error\" && step !== \"warning\") {\r\n      setError(\"\");\r\n    }\r\n    if(isError){\r\n      if(writeContractError.message.includes(\"User rejected the request\")){\r\n        setIsLoading(false);\r\n        setIsSheetOpen(false);\r\n        onMintError?.(\"User rejected the request\");\r\n        return;\r\n      }\r\n      setError(writeContractError.message || \"Could not mint\");\r\n      setStep(\"error\");\r\n      onMintError?.(writeContractError.message || \"Could not mint\");\r\n    }\r\n  }, [step, isError, error, onMintError, writeContractError]);\r\n\r\n  const handleInitialMint = async () => {\r\n    setIsLoading(true);\r\n    if (!isSDKLoaded) {\r\n      setError(\"Farcaster SDK not loaded\");\r\n      setStep(\"error\");\r\n      setIsSheetOpen(true);\r\n      return;\r\n    }\r\n    try{\r\n      const config = await getNftDetails(contractAddress, instanceId as string, tokenId as string, chainId);\r\n      setConfig(config);\r\n      if(config.claim?.erc20 !== \"0x0000000000000000000000000000000000000000\"){\r\n        await checkAllowance();\r\n        \r\n        setMintFee(formatEther(BigInt(config.mintFee || \"0\")));\r\n      }else{\r\n        const mintFee = formatEther(BigInt(config.mintFee || \"0\"))+formatEther(BigInt(config.claim?.cost || \"0\"));\r\n        setMintFee(mintFee);\r\n        setStep(\"sheet\");\r\n      }\r\n\r\n      if(config.claim?.merkleRoot !== \"0x0000000000000000000000000000000000000000000000000000000000000000\"){\r\n        setError(\"This NFT requires a merkle proof to mint. We are not supporting this yet.\");\r\n        setStep(\"warning\");\r\n        setIsLoading(false);\r\n        setIsSheetOpen(true);\r\n        return;\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Failed to get NFT details:\", err);\r\n      const errorMessage = err instanceof Error ? err.message : \"Failed to get NFT details\";\r\n      setError(errorMessage);\r\n      setStep(\"error\");\r\n      setIsLoading(false);\r\n    } finally {\r\n    setIsSheetOpen(true);\r\n    }\r\n  };\r\n\r\n  const handleConnectWallet = React.useCallback(async () => {\r\n    try {\r\n      setStep(\"connecting\");\r\n      const connector = farcasterFrame();\r\n      connect({ connector });\r\n \r\n    } catch (err) {\r\n      console.error(\"Failed to connect wallet:\", err);\r\n      const errorMessage = err instanceof Error ? err.message : \"Failed to connect wallet\";\r\n      \r\n      // For other errors, show error state\r\n      setError(errorMessage);\r\n      setStep(\"error\");\r\n    }\r\n  }, [connect]);\r\n\r\n  const checkAllowance = React.useCallback(async () => {\r\n    if(!isConnected){\r\n      await handleConnectWallet();\r\n      return;\r\n    }\r\n    if (!config?.claim?.erc20) {\r\n      setError(\"ERC20 contract not found\");\r\n      setStep(\"error\");\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n    if(!config.claim?.cost){\r\n      setError(\"Cost not found\");\r\n      setStep(\"error\");\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n    try {\r\n      const publicClient = getClientForChain(chainId);\r\n      const allowance = await publicClient.readContract({\r\n        address: config.claim?.erc20,\r\n        abi: ERC20Abi,\r\n        functionName: \"allowance\",\r\n        args: [address as Address, config.contractAddress],\r\n      });\r\n      if(allowance < BigInt(config.claim?.cost)){\r\n        setStep(\"approve\");\r\n      }else{\r\n        setStep(\"sheet\");\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Error checking allowance:\", err);\r\n      setError(\"Could not check allowance\");\r\n      setStep(\"error\");\r\n      setIsLoading(false);\r\n    }\r\n  }, [isConnected, config, chainId, address, handleConnectWallet]);\r\n\r\n\r\n  React.useEffect(() => {\r\n    if(isConnected){\r\n      if(config){\r\n        checkAllowance();\r\n    }else{\r\n      setIsSheetOpen(false);\r\n    }\r\n    }\r\n  }, [isConnected, config, checkAllowance]);\r\n\r\n\r\n  const handleApprove = async () => {\r\n    if (!isConnected) {\r\n      await handleConnectWallet();\r\n      return;\r\n    }\r\n    setIsLoading(true);\r\n    if(!config || !config.claim?.cost){\r\n      setError(\"Could not approve\");\r\n      setStep(\"error\");\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const approveTx = await writeContractAsync({\r\n        address: config.erc20ContractAddress as Address,\r\n        abi: ERC20Abi,\r\n        functionName: \"approve\",\r\n        // Use the exact amount needed for this mint\r\n        args: [config.contractAddress, BigInt(config.claim?.cost)], // spender, exact amount\r\n        chainId: config.chainId,\r\n      });\r\n      setTxHash(approveTx);\r\n      setStep(\"sheet\");\r\n    } catch (err) {\r\n      console.error(\"Error approving:\", err);\r\n      setError(\"Could not approve\");\r\n      setStep(\"error\");\r\n    } finally {\r\n      setIsLoading(false);\r\n    }   \r\n  }\r\n\r\n  \r\n  const handleMint = async () => {\r\n    if (!isConnected) {\r\n      await handleConnectWallet();\r\n      return;\r\n    }\r\n    setIsLoading(true);\r\n    if(!config){\r\n      setError(\"Could not fetch NFT details\");\r\n      setStep(\"error\");\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n\r\n    if(!config.mintFee){\r\n      setError(\"Could not fetch mint fee\");\r\n      setStep(\"error\");\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n    try{\r\n      \r\n      await checkAllowance();\r\n      let mintTx: string | undefined;\r\n      if(config.claim?.erc20 === \"0x0000000000000000000000000000000000000000\"){\r\n      setStep(\"minting\");\r\n      const mintFees = BigInt(config.mintFee)+BigInt(config.claim?.cost);\r\n      mintTx = await writeContractAsync({\r\n        address: config.extenstionContractAddress,\r\n        abi: manifoldERC1155ExtensionAbi,\r\n        functionName: \"mint\",\r\n        args: [config.contractAddress, BigInt(config.instanceId), Number(config.tokenId), [], address as Address],\r\n        chainId: config.chainId,\r\n        value: mintFees,\r\n      });\r\n      setTxHash(mintTx);\r\n    }else{\r\n      setStep(\"minting\");\r\n      const mintFees = BigInt(config.mintFee);\r\n      mintTx = await writeContractAsync({\r\n        address: config.extenstionContractAddress,\r\n        abi: manifoldERC1155ExtensionAbi,\r\n        functionName: \"mint\",\r\n        args: [config.contractAddress, BigInt(config.instanceId), Number(config.tokenId), [], address as Address],\r\n        chainId: config.chainId,\r\n        value: mintFees,\r\n      });\r\n    }\r\n    setTxHash(mintTx);\r\n    if(mintTx){\r\n      setStep(\"success\");\r\n      onMintSuccess?.(mintTx);\r\n    }else{\r\n      setError(\"Could not mint\");\r\n      setStep(\"error\");\r\n      onMintError?.(\"Could not mint\");\r\n    }\r\n  } catch (err) {\r\n    console.error(\"Error minting:\", err);\r\n    if(err instanceof Error){\r\n      setError(err.message);\r\n    }else{\r\n      setError(\"Could not mint\");\r\n    }\r\n    setStep(\"error\");\r\n    onMintError?.(\"Could not mint\");\r\n  } finally {\r\n    setIsLoading(false);\r\n    setIsSheetOpen(false);\r\n  }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setIsSheetOpen(false);\r\n    setStep(\"initial\");\r\n    setError(\"\");\r\n    setTxHash(\"\");\r\n    setIsLoading(false);\r\n  };\r\n\r\n  const handleRetry = () => {\r\n    setError(\"\");\r\n    setStep(\"sheet\");\r\n    setIsLoading(false);\r\n  };\r\n\r\n  return (\r\n    <Sheet open={isSheetOpen} onOpenChange={(open) => {\r\n      setIsSheetOpen(open);\r\n      if (!open) {\r\n        handleClose();\r\n      }\r\n    }}>\r\n      <Button\r\n        variant={variant}\r\n        size={size}\r\n        onClick={handleInitialMint}\r\n        disabled={disabled || !isSDKLoaded || isLoading}\r\n        className={cn(\"w-full\", className)}\r\n      >\r\n        <Coins className=\"h-4 w-4 mr-2\" />\r\n        {buttonText}\r\n      </Button>\r\n\r\n      <SheetContent side=\"bottom\" onClose={handleClose}>\r\n        <SheetHeader className=\"mb-6\">\r\n          <SheetTitle>\r\n            {step === \"sheet\" && \"Mint NFT\"}\r\n            {step === \"connecting\" && \"Connecting Wallet\"}\r\n            {step === \"minting\" && \"Preparing Mint\"}\r\n            {step === \"waiting\" && \"Minting...\"}\r\n            {step === \"success\" && \"Mint Successful!\"}\r\n            {step === \"error\" && \"Mint Failed\"}\r\n            {step === \"warning\" && \"Warning\"}\r\n          </SheetTitle>\r\n        </SheetHeader>\r\n\r\n        {step === \"approve\" && (\r\n          <div className=\"space-y-6\">\r\n            <div className=\"space-y-4\">\r\n              <div className=\"flex justify-between items-center py-3 border-b\">\r\n                <span className=\"text-muted-foreground\">Contract</span>\r\n                <span className=\"font-mono text-sm\">\r\n                  {contractAddress.slice(0, 6)}...{contractAddress.slice(-4)}\r\n                </span>\r\n              </div>\r\n              \r\n              <div className=\"flex justify-between items-center py-3 border-b\">\r\n                <span className=\"text-muted-foreground\">Price per NFT</span>\r\n                <span className=\"font-semibold\">\r\n                  {config?.claim ? Number(Number(config?.claim?.cost)) / 10 ** (config?.erc20Decimals || 18) : \"0\"} {config?.erc20Symbol}\r\n                </span>\r\n              </div>\r\n              <div className=\"flex justify-between items-center py-3 text-lg font-semibold\">\r\n                <span>Total Cost</span>\r\n                <span>{config?.claim ? Number(Number(config?.claim?.cost)) / 10 ** (config?.erc20Decimals || 18) : \"0\"} {config?.erc20Symbol}</span>\r\n              </div>\r\n            </div>\r\n            \r\n            <Button\r\n              onClick={handleApprove}\r\n              size=\"lg\"\r\n              className=\"w-full\"\r\n              \r\n            >\r\n              \r\n                  <Coins className=\"h-5 w-5 mr-2\" />\r\n                  Approve {config?.erc20Symbol}\r\n                \r\n              \r\n            </Button>\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 2: Sheet Content */}\r\n      {step === \"sheet\" && (\r\n          <div className=\"space-y-6\">\r\n            <div className=\"space-y-4\">\r\n              <div className=\"flex justify-between items-center py-3 border-b\">\r\n                <span className=\"text-muted-foreground\">Contract</span>\r\n                <span className=\"font-mono text-sm\">\r\n                  {contractAddress.slice(0, 6)}...{contractAddress.slice(-4)}\r\n                </span>\r\n              </div>\r\n              \r\n              <div className=\"flex justify-between items-center py-3 border-b\">\r\n                <span className=\"text-muted-foreground\">Mint Price</span>\r\n                <span className=\"font-semibold\">\r\n                  { config?.claim ? Number(Number(config?.claim?.cost)) / 10 ** (config?.erc20Decimals || 18) : \"0\"} {config?.erc20Symbol}\r\n                </span>\r\n              </div>\r\n              <div className=\"flex justify-between items-center py-3 text-lg font-semibold\">\r\n                <span>Mint Fee</span>\r\n                <span>{mintfee} ETH</span>\r\n              </div>\r\n            </div>\r\n            \r\n            <Button\r\n              onClick={isConnected ? handleMint : handleConnectWallet}\r\n              size=\"lg\"\r\n              className=\"w-full\"\r\n              disabled={isConnected ? false : true || isLoading}\r\n            >\r\n              {isConnected ? (\r\n                <>\r\n                  <Coins className=\"h-5 w-5 mr-2\" />\r\n                  Mint \r\n                </>\r\n              ) : (\r\n                \"Connect Wallet to Mint\"\r\n              )}\r\n            </Button>\r\n          </div>\r\n        )} \r\n\r\n        {/* Step 3: Connecting */}\r\n        {step === \"connecting\" && (\r\n          <div className=\"text-center space-y-4\">\r\n            <div className=\"flex justify-center\">\r\n              <Loader2 className=\"h-12 w-12 animate-spin text-primary\" />\r\n            </div>\r\n            <p className=\"text-muted-foreground\">\r\n              Connecting to your Farcaster wallet...\r\n            </p>\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 3/4: Minting */}\r\n        {step === \"minting\" && (\r\n          <div className=\"text-center space-y-4\">\r\n            <div className=\"flex justify-center\">\r\n              <Loader2 className=\"h-12 w-12 animate-spin text-primary\" />\r\n            </div>\r\n            <div>\r\n              <p className=\"font-semibold\">Preparing mint transaction</p>\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                Please approve the transaction in your wallet\r\n              </p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 4: Waiting for Transaction */}\r\n        {step === \"waiting\" && (\r\n          <div className=\"text-center space-y-4\">\r\n            <div className=\"flex justify-center\">\r\n              <Loader2 className=\"h-12 w-12 animate-spin text-primary\" />\r\n            </div>\r\n            <div>\r\n              <p className=\"font-semibold\">Transaction submitted</p>\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                Waiting for confirmation on the blockchain...\r\n              </p>\r\n              {txHash && (\r\n                <p className=\"text-xs font-mono mt-2 px-3 py-1 bg-muted rounded\">\r\n                  {txHash.slice(0, 10)}...{txHash.slice(-8)}\r\n                </p>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 5: Success */}\r\n        {step === \"success\" && (\r\n          <div className=\"text-center space-y-4\">\r\n            <div className=\"flex justify-center\">\r\n              <CheckCircle className=\"h-12 w-12 text-green-500\" />\r\n            </div>\r\n            <div>\r\n              <p className=\"font-semibold text-green-600\">Mint successful!</p>\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                Your NFT has been minted successfully\r\n              </p>\r\n              {txHash && (\r\n                <p className=\"text-xs font-mono mt-2 px-3 py-1 bg-muted rounded\">\r\n                  {txHash.slice(0, 10)}...{txHash.slice(-8)}\r\n                </p>\r\n              )}\r\n            </div>\r\n            <Button onClick={handleClose} className=\"w-full\">\r\n              Close\r\n            </Button>\r\n          </div>\r\n        )}\r\n\r\n        {/* Error State */}\r\n        {step === \"error\" && (\r\n          <div className=\"text-center space-y-4\">\r\n            <div className=\"flex justify-center\">\r\n              <AlertCircle className=\"h-12 w-12 text-red-500\" />\r\n            </div>\r\n            <div>\r\n              <p className=\"font-semibold text-red-600\">Mint failed</p>\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                {error || \"An unexpected error occurred\"}\r\n              </p>\r\n            </div>\r\n            <div className=\"flex gap-3\">\r\n              <Button variant=\"outline\" onClick={handleClose} className=\"flex-1\">\r\n                Close\r\n              </Button>\r\n              <Button onClick={handleRetry} className=\"flex-1\">\r\n                Try Again\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Warning State */}\r\n        {step === \"warning\" && (\r\n          <div className=\"text-center space-y-4\">\r\n            <div className=\"flex justify-center\">\r\n              <AlertCircle className=\"h-12 w-12 text-yellow-500\" />\r\n            </div>\r\n            <div>\r\n              <p className=\"font-semibold text-yellow-600\">Warning</p>\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                {error || \"An unexpected error occurred\"}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </SheetContent>\r\n    </Sheet>\r\n  );\r\n} ",
      "type": "registry:block"
    },
    {
      "path": "registry\\mini-app\\blocks\\manifold-nft-mint\\manifold-nft-mint.tsx",
      "content": "\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { Button } from \"@/registry/mini-app/ui/button\";\r\nimport { Sheet, SheetContent, SheetHeader, SheetTitle } from \"@/registry/mini-app/ui/sheet\";\r\nimport { useMiniAppSdk } from \"@/registry/mini-app/hooks/use-miniapp-sdk\";\r\nimport { useAccount, useConnect, useWriteContract} from \"wagmi\";\r\nimport { formatEther, type Address } from \"viem\";\r\nimport { farcasterFrame } from \"@farcaster/frame-wagmi-connector\";\r\nimport { Coins, CheckCircle, AlertCircle, Loader2 } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Claim, ERC20Abi, getClientForChain, getNftDetails, manifoldERC1155ExtensionAbi } from \"./config\";\r\n\r\ntype ManifoldNFTMintFlowProps = {\r\n  chainId: number;\r\n  contractAddress: Address;\r\n  instanceId?: string;\r\n  tokenId?: string;\r\n  className?: string;\r\n  variant?: \"default\" | \"destructive\" | \"secondary\" | \"ghost\" | \"outline\";\r\n  size?: \"default\" | \"sm\" | \"lg\" | \"icon\";\r\n  buttonText?: string;\r\n  disabled?: boolean;\r\n  onMintSuccess?: (txHash: string) => void;\r\n  onMintError?: (error: string) => void;\r\n};\r\n\r\ntype MintStep = \"initial\" | \"approve\" | \"sheet\" | \"connecting\" | \"minting\" | \"waiting\" | \"success\" | \"error\" | \"warning\";\r\n\r\nexport type Config = {\r\n  contractAddress: Address;\r\n  instanceId: string;\r\n  chainId: number;\r\n  tokenId: bigint;\r\n  claim: Claim;\r\n  extenstionContractAddress: Address;\r\n  erc20ContractAddress?: Address;\r\n  erc20Decimals?: number;\r\n  erc20Symbol?: string;\r\n  mintFee?: string;\r\n}\r\n\r\nexport function ManifoldNFTMint({\r\n  chainId,\r\n  contractAddress,\r\n  instanceId,\r\n  tokenId,\r\n  className,\r\n  variant = \"default\",\r\n  size = \"default\",\r\n  buttonText = \"Mint NFT\",\r\n  disabled = false,\r\n  onMintSuccess,\r\n  onMintError,\r\n}: ManifoldNFTMintFlowProps) {\r\n  const [step, setStep] = React.useState<MintStep>(\"initial\");\r\n  const [error, setError] = React.useState<string>(\"\");\r\n  const [txHash, setTxHash] = React.useState<string>(\"\");\r\n  const [isLoading, setIsLoading] = React.useState(false);\r\n  const [isSheetOpen, setIsSheetOpen] = React.useState(false);\r\n  const { isSDKLoaded } = useMiniAppSdk();\r\n  const { isConnected, address } = useAccount();\r\n  const { connect } = useConnect();\r\n  const { writeContractAsync , isError, error: writeContractError} = useWriteContract();\r\n\r\n  const [config, setConfig] = React.useState<Config | undefined>(undefined);\r\n  const [mintfee, setMintFee] = React.useState<string>(\"\");\r\n \r\n\r\n  // Reset error when step changes\r\n  React.useEffect(() => {\r\n    if (step !== \"error\" && step !== \"warning\") {\r\n      setError(\"\");\r\n    }\r\n    if(isError){\r\n      if(writeContractError.message.includes(\"User rejected the request\")){\r\n        setIsLoading(false);\r\n        setIsSheetOpen(false);\r\n        onMintError?.(\"User rejected the request\");\r\n        return;\r\n      }\r\n      setError(writeContractError.message || \"Could not mint\");\r\n      setStep(\"error\");\r\n      onMintError?.(writeContractError.message || \"Could not mint\");\r\n    }\r\n  }, [step, isError, error, onMintError, writeContractError]);\r\n\r\n  const handleInitialMint = async () => {\r\n    setIsLoading(true);\r\n    if (!isSDKLoaded) {\r\n      setError(\"Farcaster SDK not loaded\");\r\n      setStep(\"error\");\r\n      setIsSheetOpen(true);\r\n      return;\r\n    }\r\n    try{\r\n      const config = await getNftDetails(contractAddress, instanceId as string, tokenId as string, chainId);\r\n      setConfig(config);\r\n      if(config.claim?.erc20 !== \"0x0000000000000000000000000000000000000000\"){\r\n        await checkAllowance();\r\n        \r\n        setMintFee(formatEther(BigInt(config.mintFee || \"0\")));\r\n      }else{\r\n        const mintFee = formatEther(BigInt(config.mintFee || \"0\"))+formatEther(BigInt(config.claim?.cost || \"0\"));\r\n        setMintFee(mintFee);\r\n        setStep(\"sheet\");\r\n      }\r\n\r\n      if(config.claim?.merkleRoot !== \"0x0000000000000000000000000000000000000000000000000000000000000000\"){\r\n        setError(\"This NFT requires a merkle proof to mint. We are not supporting this yet.\");\r\n        setStep(\"warning\");\r\n        setIsLoading(false);\r\n        setIsSheetOpen(true);\r\n        return;\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Failed to get NFT details:\", err);\r\n      const errorMessage = err instanceof Error ? err.message : \"Failed to get NFT details\";\r\n      setError(errorMessage);\r\n      setStep(\"error\");\r\n      setIsLoading(false);\r\n    } finally {\r\n    setIsSheetOpen(true);\r\n    }\r\n  };\r\n\r\n  const handleConnectWallet = React.useCallback(async () => {\r\n    try {\r\n      setStep(\"connecting\");\r\n      const connector = farcasterFrame();\r\n      connect({ connector });\r\n \r\n    } catch (err) {\r\n      console.error(\"Failed to connect wallet:\", err);\r\n      const errorMessage = err instanceof Error ? err.message : \"Failed to connect wallet\";\r\n      \r\n      // For other errors, show error state\r\n      setError(errorMessage);\r\n      setStep(\"error\");\r\n    }\r\n  }, [connect]);\r\n\r\n  const checkAllowance = React.useCallback(async () => {\r\n    if(!isConnected){\r\n      await handleConnectWallet();\r\n      return;\r\n    }\r\n    if (!config?.claim?.erc20) {\r\n      setError(\"ERC20 contract not found\");\r\n      setStep(\"error\");\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n    if(!config.claim?.cost){\r\n      setError(\"Cost not found\");\r\n      setStep(\"error\");\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n    try {\r\n      const publicClient = getClientForChain(chainId);\r\n      const allowance = await publicClient.readContract({\r\n        address: config.claim?.erc20,\r\n        abi: ERC20Abi,\r\n        functionName: \"allowance\",\r\n        args: [address as Address, config.contractAddress],\r\n      });\r\n      if(allowance < BigInt(config.claim?.cost)){\r\n        setStep(\"approve\");\r\n      }else{\r\n        setStep(\"sheet\");\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Error checking allowance:\", err);\r\n      setError(\"Could not check allowance\");\r\n      setStep(\"error\");\r\n      setIsLoading(false);\r\n    }\r\n  }, [isConnected, config, chainId, address, handleConnectWallet]);\r\n\r\n\r\n  React.useEffect(() => {\r\n    if(isConnected){\r\n      if(config){\r\n        checkAllowance();\r\n    }else{\r\n      setIsSheetOpen(false);\r\n    }\r\n    }\r\n  }, [isConnected, config, checkAllowance]);\r\n\r\n\r\n  const handleApprove = async () => {\r\n    if (!isConnected) {\r\n      await handleConnectWallet();\r\n      return;\r\n    }\r\n    setIsLoading(true);\r\n    if(!config || !config.claim?.cost){\r\n      setError(\"Could not approve\");\r\n      setStep(\"error\");\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const approveTx = await writeContractAsync({\r\n        address: config.erc20ContractAddress as Address,\r\n        abi: ERC20Abi,\r\n        functionName: \"approve\",\r\n        // Use the exact amount needed for this mint\r\n        args: [config.contractAddress, BigInt(config.claim?.cost)], // spender, exact amount\r\n        chainId: config.chainId,\r\n      });\r\n      setTxHash(approveTx);\r\n      setStep(\"sheet\");\r\n    } catch (err) {\r\n      console.error(\"Error approving:\", err);\r\n      setError(\"Could not approve\");\r\n      setStep(\"error\");\r\n    } finally {\r\n      setIsLoading(false);\r\n    }   \r\n  }\r\n\r\n  \r\n  const handleMint = async () => {\r\n    if (!isConnected) {\r\n      await handleConnectWallet();\r\n      return;\r\n    }\r\n    setIsLoading(true);\r\n    if(!config){\r\n      setError(\"Could not fetch NFT details\");\r\n      setStep(\"error\");\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n\r\n    if(!config.mintFee){\r\n      setError(\"Could not fetch mint fee\");\r\n      setStep(\"error\");\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n    try{\r\n      \r\n      await checkAllowance();\r\n      let mintTx: string | undefined;\r\n      if(config.claim?.erc20 === \"0x0000000000000000000000000000000000000000\"){\r\n      setStep(\"minting\");\r\n      const mintFees = BigInt(config.mintFee)+BigInt(config.claim?.cost);\r\n      mintTx = await writeContractAsync({\r\n        address: config.extenstionContractAddress,\r\n        abi: manifoldERC1155ExtensionAbi,\r\n        functionName: \"mint\",\r\n        args: [config.contractAddress, BigInt(config.instanceId), Number(config.tokenId), [], address as Address],\r\n        chainId: config.chainId,\r\n        value: mintFees,\r\n      });\r\n      setTxHash(mintTx);\r\n    }else{\r\n      setStep(\"minting\");\r\n      const mintFees = BigInt(config.mintFee);\r\n      mintTx = await writeContractAsync({\r\n        address: config.extenstionContractAddress,\r\n        abi: manifoldERC1155ExtensionAbi,\r\n        functionName: \"mint\",\r\n        args: [config.contractAddress, BigInt(config.instanceId), Number(config.tokenId), [], address as Address],\r\n        chainId: config.chainId,\r\n        value: mintFees,\r\n      });\r\n    }\r\n    setTxHash(mintTx);\r\n    if(mintTx){\r\n      setStep(\"success\");\r\n      onMintSuccess?.(mintTx);\r\n    }else{\r\n      setError(\"Could not mint\");\r\n      setStep(\"error\");\r\n      onMintError?.(\"Could not mint\");\r\n    }\r\n  } catch (err) {\r\n    console.error(\"Error minting:\", err);\r\n    if(err instanceof Error){\r\n      setError(err.message);\r\n    }else{\r\n      setError(\"Could not mint\");\r\n    }\r\n    setStep(\"error\");\r\n    onMintError?.(\"Could not mint\");\r\n  } finally {\r\n    setIsLoading(false);\r\n    setIsSheetOpen(false);\r\n  }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setIsSheetOpen(false);\r\n    setStep(\"initial\");\r\n    setError(\"\");\r\n    setTxHash(\"\");\r\n    setIsLoading(false);\r\n  };\r\n\r\n  const handleRetry = () => {\r\n    setError(\"\");\r\n    setStep(\"sheet\");\r\n    setIsLoading(false);\r\n  };\r\n\r\n  return (\r\n    <Sheet open={isSheetOpen} onOpenChange={(open) => {\r\n      setIsSheetOpen(open);\r\n      if (!open) {\r\n        handleClose();\r\n      }\r\n    }}>\r\n      <Button\r\n        variant={variant}\r\n        size={size}\r\n        onClick={handleInitialMint}\r\n        disabled={disabled || !isSDKLoaded || isLoading}\r\n        className={cn(\"w-full\", className)}\r\n      >\r\n        <Coins className=\"h-4 w-4 mr-2\" />\r\n        {buttonText}\r\n      </Button>\r\n\r\n      <SheetContent side=\"bottom\" onClose={handleClose}>\r\n        <SheetHeader className=\"mb-6\">\r\n          <SheetTitle>\r\n            {step === \"sheet\" && \"Mint NFT\"}\r\n            {step === \"connecting\" && \"Connecting Wallet\"}\r\n            {step === \"minting\" && \"Preparing Mint\"}\r\n            {step === \"waiting\" && \"Minting...\"}\r\n            {step === \"success\" && \"Mint Successful!\"}\r\n            {step === \"error\" && \"Mint Failed\"}\r\n            {step === \"warning\" && \"Warning\"}\r\n          </SheetTitle>\r\n        </SheetHeader>\r\n\r\n        {step === \"approve\" && (\r\n          <div className=\"space-y-6\">\r\n            <div className=\"space-y-4\">\r\n              <div className=\"flex justify-between items-center py-3 border-b\">\r\n                <span className=\"text-muted-foreground\">Contract</span>\r\n                <span className=\"font-mono text-sm\">\r\n                  {contractAddress.slice(0, 6)}...{contractAddress.slice(-4)}\r\n                </span>\r\n              </div>\r\n              \r\n              <div className=\"flex justify-between items-center py-3 border-b\">\r\n                <span className=\"text-muted-foreground\">Price per NFT</span>\r\n                <span className=\"font-semibold\">\r\n                  {config?.claim ? Number(Number(config?.claim?.cost)) / 10 ** (config?.erc20Decimals || 18) : \"0\"} {config?.erc20Symbol}\r\n                </span>\r\n              </div>\r\n              <div className=\"flex justify-between items-center py-3 text-lg font-semibold\">\r\n                <span>Total Cost</span>\r\n                <span>{config?.claim ? Number(Number(config?.claim?.cost)) / 10 ** (config?.erc20Decimals || 18) : \"0\"} {config?.erc20Symbol}</span>\r\n              </div>\r\n            </div>\r\n            \r\n            <Button\r\n              onClick={handleApprove}\r\n              size=\"lg\"\r\n              className=\"w-full\"\r\n              \r\n            >\r\n              \r\n                  <Coins className=\"h-5 w-5 mr-2\" />\r\n                  Approve {config?.erc20Symbol}\r\n                \r\n              \r\n            </Button>\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 2: Sheet Content */}\r\n      {step === \"sheet\" && (\r\n          <div className=\"space-y-6\">\r\n            <div className=\"space-y-4\">\r\n              <div className=\"flex justify-between items-center py-3 border-b\">\r\n                <span className=\"text-muted-foreground\">Contract</span>\r\n                <span className=\"font-mono text-sm\">\r\n                  {contractAddress.slice(0, 6)}...{contractAddress.slice(-4)}\r\n                </span>\r\n              </div>\r\n              \r\n              <div className=\"flex justify-between items-center py-3 border-b\">\r\n                <span className=\"text-muted-foreground\">Mint Price</span>\r\n                <span className=\"font-semibold\">\r\n                  { config?.claim ? Number(Number(config?.claim?.cost)) / 10 ** (config?.erc20Decimals || 18) : \"0\"} {config?.erc20Symbol}\r\n                </span>\r\n              </div>\r\n              <div className=\"flex justify-between items-center py-3 text-lg font-semibold\">\r\n                <span>Mint Fee</span>\r\n                <span>{mintfee} ETH</span>\r\n              </div>\r\n            </div>\r\n            \r\n            <Button\r\n              onClick={isConnected ? handleMint : handleConnectWallet}\r\n              size=\"lg\"\r\n              className=\"w-full\"\r\n              disabled={isConnected ? false : true || isLoading}\r\n            >\r\n              {isConnected ? (\r\n                <>\r\n                  <Coins className=\"h-5 w-5 mr-2\" />\r\n                  Mint \r\n                </>\r\n              ) : (\r\n                \"Connect Wallet to Mint\"\r\n              )}\r\n            </Button>\r\n          </div>\r\n        )} \r\n\r\n        {/* Step 3: Connecting */}\r\n        {step === \"connecting\" && (\r\n          <div className=\"text-center space-y-4\">\r\n            <div className=\"flex justify-center\">\r\n              <Loader2 className=\"h-12 w-12 animate-spin text-primary\" />\r\n            </div>\r\n            <p className=\"text-muted-foreground\">\r\n              Connecting to your Farcaster wallet...\r\n            </p>\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 3/4: Minting */}\r\n        {step === \"minting\" && (\r\n          <div className=\"text-center space-y-4\">\r\n            <div className=\"flex justify-center\">\r\n              <Loader2 className=\"h-12 w-12 animate-spin text-primary\" />\r\n            </div>\r\n            <div>\r\n              <p className=\"font-semibold\">Preparing mint transaction</p>\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                Please approve the transaction in your wallet\r\n              </p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 4: Waiting for Transaction */}\r\n        {step === \"waiting\" && (\r\n          <div className=\"text-center space-y-4\">\r\n            <div className=\"flex justify-center\">\r\n              <Loader2 className=\"h-12 w-12 animate-spin text-primary\" />\r\n            </div>\r\n            <div>\r\n              <p className=\"font-semibold\">Transaction submitted</p>\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                Waiting for confirmation on the blockchain...\r\n              </p>\r\n              {txHash && (\r\n                <p className=\"text-xs font-mono mt-2 px-3 py-1 bg-muted rounded\">\r\n                  {txHash.slice(0, 10)}...{txHash.slice(-8)}\r\n                </p>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 5: Success */}\r\n        {step === \"success\" && (\r\n          <div className=\"text-center space-y-4\">\r\n            <div className=\"flex justify-center\">\r\n              <CheckCircle className=\"h-12 w-12 text-green-500\" />\r\n            </div>\r\n            <div>\r\n              <p className=\"font-semibold text-green-600\">Mint successful!</p>\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                Your NFT has been minted successfully\r\n              </p>\r\n              {txHash && (\r\n                <p className=\"text-xs font-mono mt-2 px-3 py-1 bg-muted rounded\">\r\n                  {txHash.slice(0, 10)}...{txHash.slice(-8)}\r\n                </p>\r\n              )}\r\n            </div>\r\n            <Button onClick={handleClose} className=\"w-full\">\r\n              Close\r\n            </Button>\r\n          </div>\r\n        )}\r\n\r\n        {/* Error State */}\r\n        {step === \"error\" && (\r\n          <div className=\"text-center space-y-4\">\r\n            <div className=\"flex justify-center\">\r\n              <AlertCircle className=\"h-12 w-12 text-red-500\" />\r\n            </div>\r\n            <div>\r\n              <p className=\"font-semibold text-red-600\">Mint failed</p>\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                {error || \"An unexpected error occurred\"}\r\n              </p>\r\n            </div>\r\n            <div className=\"flex gap-3\">\r\n              <Button variant=\"outline\" onClick={handleClose} className=\"flex-1\">\r\n                Close\r\n              </Button>\r\n              <Button onClick={handleRetry} className=\"flex-1\">\r\n                Try Again\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Warning State */}\r\n        {step === \"warning\" && (\r\n          <div className=\"text-center space-y-4\">\r\n            <div className=\"flex justify-center\">\r\n              <AlertCircle className=\"h-12 w-12 text-yellow-500\" />\r\n            </div>\r\n            <div>\r\n              <p className=\"font-semibold text-yellow-600\">Warning</p>\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                {error || \"An unexpected error occurred\"}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </SheetContent>\r\n    </Sheet>\r\n  );\r\n} ",
      "type": "registry:component",
      "target": ""
    },
    {
      "path": "registry\\mini-app\\ui\\button.tsx",
      "content": "import * as React from \"react\"\r\nimport { Slot } from \"@radix-ui/react-slot\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst buttonVariants = cva(\r\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default:\r\n          \"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90\",\r\n        destructive:\r\n          \"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60\",\r\n        outline:\r\n          \"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50\",\r\n        secondary:\r\n          \"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80\",\r\n        ghost:\r\n          \"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50\",\r\n        link: \"text-primary underline-offset-4 hover:underline\",\r\n      },\r\n      size: {\r\n        default: \"h-9 px-4 py-2 has-[>svg]:px-3\",\r\n        sm: \"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5\",\r\n        lg: \"h-10 rounded-md px-6 has-[>svg]:px-4\",\r\n        icon: \"size-9\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nfunction Button({\r\n  className,\r\n  variant,\r\n  size,\r\n  asChild = false,\r\n  ...props\r\n}: React.ComponentProps<\"button\"> &\r\n  VariantProps<typeof buttonVariants> & {\r\n    asChild?: boolean\r\n  }) {\r\n  const Comp = asChild ? Slot : \"button\"\r\n\r\n  return (\r\n    <Comp\r\n      data-slot=\"button\"\r\n      className={cn(buttonVariants({ variant, size, className }))}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport { Button, buttonVariants }\r\n",
      "type": "registry:ui",
      "target": ""
    },
    {
      "path": "lib\\utils.ts",
      "content": "import { clsx, type ClassValue } from \"clsx\";\r\nimport { twMerge } from \"tailwind-merge\";\r\n\r\nexport function cn(...inputs: ClassValue[]) {\r\n  return twMerge(clsx(inputs));\r\n}\r\n\r\n\r\nexport const formatLargeNumber = (num?: number): string => {\r\n  if (!num) return '0';\r\n\r\n  if (num >= 1000000) {\r\n    return (num / 1000000).toFixed(1) + 'M';\r\n  } else if (num >= 2000) {\r\n    return (num / 1000).toFixed(1) + 'K';\r\n  } else {\r\n    return num.toString();\r\n  }\r\n};",
      "type": "registry:lib",
      "target": ""
    },
    {
      "path": "registry\\mini-app\\ui\\sheet.tsx",
      "content": "\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\nimport { X } from \"lucide-react\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst sheetVariants = cva(\r\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition-all duration-300 ease-in-out border rounded-lg\",\r\n  {\r\n    variants: {\r\n      side: {\r\n        top: \"inset-x-4 top-4 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\r\n        bottom: \"inset-x-4 bottom-4 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\r\n        left: \"inset-y-4 left-4 w-3/4 max-w-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left\",\r\n        right: \"inset-y-4 right-4 w-3/4 max-w-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      side: \"bottom\",\r\n    },\r\n  }\r\n)\r\n\r\ninterface SheetProps {\r\n  open?: boolean\r\n  onOpenChange?: (open: boolean) => void\r\n  children: React.ReactNode\r\n}\r\n\r\ninterface SheetContentProps\r\n  extends React.HTMLAttributes<HTMLDivElement>,\r\n    VariantProps<typeof sheetVariants> {\r\n  onClose?: () => void\r\n}\r\n\r\nconst SheetContext = React.createContext<{\r\n  open: boolean\r\n  onOpenChange: (open: boolean) => void\r\n}>({\r\n  open: false,\r\n  onOpenChange: () => {},\r\n})\r\n\r\nexport function Sheet({ open = false, onOpenChange, children }: SheetProps) {\r\n  return (\r\n    <SheetContext.Provider value={{ open, onOpenChange: onOpenChange || (() => {}) }}>\r\n      {children}\r\n    </SheetContext.Provider>\r\n  )\r\n}\r\n\r\nexport function SheetTrigger({ \r\n  children, \r\n  onClick,\r\n  ...props \r\n}: React.ButtonHTMLAttributes<HTMLButtonElement>) {\r\n  const { onOpenChange } = React.useContext(SheetContext)\r\n  \r\n  return (\r\n    <button\r\n      onClick={(e) => {\r\n        onOpenChange(true)\r\n        onClick?.(e)\r\n      }}\r\n      {...props}\r\n    >\r\n      {children}\r\n    </button>\r\n  )\r\n}\r\n\r\nexport function SheetContent({ \r\n  side = \"bottom\", \r\n  className, \r\n  children, \r\n  onClose,\r\n  ...props \r\n}: SheetContentProps) {\r\n  const { open, onOpenChange } = React.useContext(SheetContext)\r\n\r\n  const handleClose = () => {\r\n    onOpenChange(false)\r\n    onClose?.()\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    const handleEscape = (e: KeyboardEvent) => {\r\n      if (e.key === \"Escape\" && open) {\r\n        handleClose()\r\n      }\r\n    }\r\n\r\n    if (open) {\r\n      document.addEventListener(\"keydown\", handleEscape)\r\n      document.body.style.overflow = \"hidden\"\r\n    }\r\n\r\n    return () => {\r\n      document.removeEventListener(\"keydown\", handleEscape)\r\n      document.body.style.overflow = \"unset\"\r\n    }\r\n  }, [open])\r\n\r\n  if (!open) return null\r\n\r\n  return (\r\n    <>\r\n      {/* Backdrop */}\r\n      <div \r\n        className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-40\"\r\n        onClick={handleClose}\r\n      />\r\n      \r\n      {/* Sheet Content */}\r\n      <div\r\n        className={cn(sheetVariants({ side }), className)}\r\n        data-state={open ? \"open\" : \"closed\"}\r\n        {...props}\r\n      >\r\n        {children}\r\n        <button\r\n          onClick={handleClose}\r\n          className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none p-1\"\r\n        >\r\n          <X className=\"h-4 w-4\" />\r\n          <span className=\"sr-only\">Close</span>\r\n        </button>\r\n      </div>\r\n    </>\r\n  )\r\n}\r\n\r\nexport function SheetClose({ \r\n  children, \r\n  onClick,\r\n  ...props \r\n}: React.ButtonHTMLAttributes<HTMLButtonElement>) {\r\n  const { onOpenChange } = React.useContext(SheetContext)\r\n  \r\n  return (\r\n    <button\r\n      onClick={(e) => {\r\n        onOpenChange(false)\r\n        onClick?.(e)\r\n      }}\r\n      {...props}\r\n    >\r\n      {children}\r\n    </button>\r\n  )\r\n}\r\n\r\nexport function SheetHeader({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLDivElement>) {\r\n  return (\r\n    <div\r\n      className={cn(\r\n        \"flex flex-col space-y-2 text-center sm:text-left\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport function SheetFooter({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLDivElement>) {\r\n  return (\r\n    <div\r\n      className={cn(\r\n        \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport function SheetTitle({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLHeadingElement>) {\r\n  return (\r\n    <h2\r\n      className={cn(\"text-lg font-semibold text-foreground\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport function SheetDescription({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLParagraphElement>) {\r\n  return (\r\n    <p\r\n      className={cn(\"text-sm text-muted-foreground\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n} ",
      "type": "registry:ui",
      "target": ""
    },
    {
      "path": "registry\\mini-app\\hooks\\use-miniapp-sdk.ts",
      "content": "\"use client\";\r\n\r\nimport { useCallback, useEffect, useState } from \"react\";\r\nimport sdk from \"@farcaster/frame-sdk\";\r\nimport type { Context } from \"@farcaster/frame-core\";\r\nexport function useMiniAppSdk() {\r\n  const [isAuthDialogOpen, setIsAuthDialogOpen] = useState(false);\r\n\r\n  const [isSDKLoaded, setIsSDKLoaded] = useState(false);\r\n  const [context, setContext] = useState<Context.FrameContext>();\r\n  const [isMiniAppSaved, setIsMiniAppSaved] = useState(false);\r\n  const [lastEvent, setLastEvent] = useState(\"\");\r\n  const [pinFrameResponse, setPinFrameResponse] = useState(\"\");\r\n  const [isSigningIn, setIsSigningIn] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!sdk) return;\r\n\r\n    sdk.on(\"frameAdded\", ({ notificationDetails }) => {\r\n      setLastEvent(\r\n        `frameAdded${notificationDetails ? \", notifications enabled\" : \"\"}`,\r\n      );\r\n      setIsMiniAppSaved(true);\r\n    });\r\n\r\n    sdk.on(\"frameAddRejected\", ({ reason }) => {\r\n      setLastEvent(`frameAddRejected, reason ${reason}`);\r\n    });\r\n\r\n    sdk.on(\"frameRemoved\", () => {\r\n      setLastEvent(\"frameRemoved\");\r\n      setIsMiniAppSaved(false);\r\n    });\r\n\r\n    sdk.on(\"notificationsEnabled\", ({ notificationDetails }) => {\r\n      setLastEvent(\"notificationsEnabled\");\r\n    });\r\n\r\n    sdk.on(\"notificationsDisabled\", () => {\r\n      setLastEvent(\"notificationsDisabled\");\r\n    });\r\n\r\n    // CRITICAL TO LOAD MINI APP - DON'T REMOVE\r\n    sdk.actions.ready({});\r\n    setIsSDKLoaded(true);\r\n\r\n    // Clean up on unmount\r\n    return () => {\r\n      sdk.removeAllListeners();\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const updateContext = async () => {\r\n      const frameContext = await sdk.context;\r\n      if (frameContext) {\r\n        setContext(frameContext);\r\n        setIsMiniAppSaved(frameContext.client.added);\r\n      }\r\n    };\r\n\r\n    if (isSDKLoaded) {\r\n      updateContext();\r\n    }\r\n  }, [isSDKLoaded]);\r\n\r\n  const pinFrame = useCallback(async () => {\r\n    try {\r\n      const result = await sdk.actions.addFrame();\r\n      console.log(\"addFrame result\", result);\r\n      // @ts-expect-error - result type mixup\r\n      if (result.added) {\r\n        setPinFrameResponse(\r\n          result.notificationDetails\r\n            ? `Added, got notificaton token ${result.notificationDetails.token} and url ${result.notificationDetails.url}`\r\n            : \"Added, got no notification details\",\r\n        );\r\n      }\r\n    } catch (error) {\r\n      setPinFrameResponse(`Error: ${error}`);\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    context,\r\n    pinFrame,\r\n    pinFrameResponse,\r\n    isMiniAppSaved,\r\n    lastEvent,\r\n    sdk,\r\n    isSDKLoaded,\r\n    isAuthDialogOpen,\r\n    setIsAuthDialogOpen,\r\n    isSigningIn,\r\n  };\r\n}\r\n",
      "type": "registry:hook",
      "target": ""
    }
  ]
}